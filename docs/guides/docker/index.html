<!doctype html>
<html>
<head>
  <title>KillrVideo - Docker and Infrastructure Dependencies</title>
  <link href="/assets/css/bundle.css" rel="stylesheet">
  <link rel="icon" type="image/png" href="/assets/images/killrvideo-icon.png"/>
  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
  
  <header>
    <nav class="nav">
      <div class="container">
        <div class="nav-left">
          <a href="/" class="nav-item">
            <img src="/assets/images/killrvideo.png" alt="KillrVideo logo" />
          </a>
        </div>

        <!-- Nav Toggle on mobile -->
        <span class="nav-toggle">
          <span></span>
          <span></span>
          <span></span>
        </span>

        <div class="nav-right nav-menu">
          <span class="nav-item">
            <a href="/getting-started/" class="button is-primary">
              <i class="fa fa-code fa-fw"></i> Get Started
            </a>
          </span>
          <a href="/docs/" class="nav-item">
            Docs
          </a>
          <a href="/blog/" class="nav-item">
            Blog
          </a>
          <a href="https://github.com/KillrVideo" target="_blank" class="nav-item">
            <i class="fa fa-github fa-2x"></i>
          </a>
        </div>
      </div>
    </nav>
  </header>

  
  
<section class="section">
  <div class="container">
    <div class="columns">
      <article class="column is-9 content">
        <h1 id="docker-and-infrastructure-dependencies">Docker and Infrastructure Dependencies</h1>
<p>In KillrVideo, we offer microservice implementations in multiple programming languages, but
each of these implementations have a base common set of dependencies they need in order
to be a functional reference application. Those base dependencies are:</p>
<ul>
<li><a href="http://www.datastax.com/products/datastax-enterprise" target="_blank"><strong>DataStax Enterprise</strong></a>: we need at least one node of DSE / Cassandra running that
the microservices implementations can use to store data.</li>
<li><a href="https://github.com/killrvideo/killrvideo-web" target="_blank"><strong>KillrVideo Web Tier</strong></a>: we need the Web Tier in order to provide a
working UI and applicaiton that drives calls to the microservices.</li>
<li><a href="https://github.com/coreos/etcd" target="_blank"><strong>etcd</strong></a>: we use etcd as our service registry for service discovery so that our
microservices know where to find DSE and our Web Tier knows where to find our microservices.</li>
</ul>
<p>For a developer looking to learn about Cassandra and DSE it would be impractical (and kind
of ridiculous) to ask them to install all of these things locally in addition to the code
for the microservices implementation they are interested in. Instead, we&#39;ve chosen to use
<a href="https://www.docker.com/" target="_blank">Docker</a> to run these dependencies. Docker has become an increasingly popular way
for developers to run infrastructure on their local dev machines. This way, the only thing a
developer needs to install is Docker for Mac or Windows in order to try out KillrVideo (and 
chances are they may already have it installed).</p>
<h2 id="docker-compose-for-starting-dependencies">Docker Compose for Starting Dependencies</h2>
<p>The <a href="https://www.docker.com/" target="_blank">Docker</a> project offers a nice tool called <a href="https://docs.docker.com/compose/overview/" target="_blank">Docker Compose</a> which
allows you to run multiple Docker containers that are defined in a <code>.yaml</code> file. We created
the <a href="https://github.com/KillrVideo/killrvideo-docker-common" target="_blank">killrvideo-docker-common</a> project to house the configuration that is the
same across many of our projects. This project includes two main things:</p>
<ul>
<li>A base <code>docker-compose.yaml</code> configuration that includes etcd, a single DSE node, and 
<a href="http://gliderlabs.com/registrator/latest/" target="_blank">Registrator</a>, a program that automatically registers and deregisters Docker 
containers with our Etcd service registry when they are started and stopped.</li>
<li>Helper scripts (for Windows and Mac) that can be used to determine the Docker network
setup on a developer&#39;s machine so we know what IP addresses the components can use to
communicate with each other.</li>
</ul>
<p>You might notice that the Web Tier is not listed as one of the dependencies specified in the
base <code>docker-compose.yaml</code> file. This is because the <a href="https://github.com/killrvideo/killrvideo-web" target="_blank">killrvideo-web</a>
project also depends on the <a href="https://github.com/KillrVideo/killrvideo-docker-common" target="_blank">killrvideo-docker-common</a> project to spin up 
dependencies when it&#39;s being developed. In the microservice implementations, we take 
advantage of a feature of Docker Compose that lets us define a <code>.yaml</code> file that inherits
from our base <code>.yaml</code> file and then provide overrides and additions. In this way, each
programming language&#39;s microservice project can specify the Web Tier as a dependency (along
with any other infrastructure they might need, for example, messaging infrastructure).</p>
<h2 id="docker-environment-scripts">Docker Environment Scripts</h2>
<p>As mentioned above, the <a href="https://github.com/KillrVideo/killrvideo-docker-common" target="_blank">killrvideo-docker-common</a> project also contains some
scripts that are useful for determining a developer&#39;s Docker setup. These scripts can be
used to create a <code>.env</code> file which is used by <a href="https://docs.docker.com/compose/overview/" target="_blank">Docker Compose</a> when it runs to set
environment variables needed by KillrVideo. That <code>.env</code> file can also be used by the various
microservice implementations to make sure that they register themselves with the appropriate
IP address in <a href="https://github.com/coreos/etcd" target="_blank">etcd</a> for service discovery. The output from those scripts is:</p>
<ul>
<li><code>KILLRVIDEO_DOCKER_IP</code>: the Docker VM&#39;s IP where the containers are hosted. This is where
the Web UI, DSE node, and etcd are available.</li>
<li><code>KILLRVIDEO_HOST_IP</code>: the IP address of the user&#39;s local dev machine. This is the IP
address that the microservices should use to listen on and to register themselves with etcd.</li>
<li><code>KILLRVIDEO_DOCKER_TOOLBOX</code>: set to either <code>true</code> or <code>false</code> depending on whether the
local docker environment is a Docker Toolbox setup.</li>
</ul>
<p>Once we have the <code>docker-compose.yaml</code> files described above, as well as a <code>.env</code> file from
running the helper scripts, it&#39;s easy to start all our infrastructure dependencies by simply
running:</p>
<pre><code>> docker-compose up</code></pre><p>Next, we&#39;ll take a quick look at service discovery in KillrVideo with etcd.</p>
<p><a href="/docs/guides/service-discovery/">Next: Service Discovery with etcd</a></p>

      </article>
      <nav class="column is-3">
        <ul>
          
          <li class="link-list-item">
            <a href="/docs/guides/architecture/">High Level Architecture Overview</a>
            <ul>
            
              <li class="link-list-item">
                <a href="/docs/guides/architecture/#microservices-tier">Microservices Tier</a>
              </li>
            
              <li class="link-list-item">
                <a href="/docs/guides/architecture/#using-events-for-service-collaboration">Using Events for Service Collaboration</a>
              </li>
            
            </ul>
          </li>
          
          <li class="link-list-item selected">
            <a href="/docs/guides/docker/">Docker and Infrastructure Dependencies</a>
            <ul>
            
              <li class="link-list-item">
                <a href="/docs/guides/docker/#docker-compose-for-starting-dependencies">Docker Compose for Starting Dependencies</a>
              </li>
            
              <li class="link-list-item">
                <a href="/docs/guides/docker/#docker-environment-scripts">Docker Environment Scripts</a>
              </li>
            
            </ul>
          </li>
          
          <li class="link-list-item">
            <a href="/docs/guides/microservices-tier/">Microservice Tier Implementation</a>
            <ul>
            
              <li class="link-list-item">
                <a href="/docs/guides/microservices-tier/#service-and-event-definitions-with-protocol-buffers">Service and Event Definitions with Protocol Buffers</a>
              </li>
            
              <li class="link-list-item">
                <a href="/docs/guides/microservices-tier/#grpc-client-on-the-web-server">Grpc Client on the Web Server</a>
              </li>
            
              <li class="link-list-item">
                <a href="/docs/guides/microservices-tier/#grpc-server-in-microservices">Grpc Server in Microservices</a>
              </li>
            
              <li class="link-list-item">
                <a href="/docs/guides/microservices-tier/#pub-sub-messaging-and-other-supporting-infrastructure">Pub-Sub Messaging and Other Supporting Infrastructure</a>
              </li>
            
            </ul>
          </li>
          
          <li class="link-list-item">
            <a href="/docs/guides/service-discovery/">Service Discovery with etcd</a>
            <ul>
            
              <li class="link-list-item">
                <a href="/docs/guides/service-discovery/#querying-etcd">Querying etcd</a>
              </li>
            
              <li class="link-list-item">
                <a href="/docs/guides/service-discovery/#registering-services-in-etcd">Registering services in etcd</a>
              </li>
            
            </ul>
          </li>
          
          <li class="link-list-item">
            <a href="/docs/guides/web-tier/">Web Tier Implementation</a>
            <ul>
            
              <li class="link-list-item">
                <a href="/docs/guides/web-tier/#web-client">Web Client</a>
              </li>
            
              <li class="link-list-item">
                <a href="/docs/guides/web-tier/#web-server">Web Server</a>
              </li>
            
              <li class="link-list-item">
                <a href="/docs/guides/web-tier/#web-client-and-server-communication-via-falcor">Web Client and Server Communication via Falcor</a>
              </li>
            
              <li class="link-list-item">
                <a href="/docs/guides/web-tier/#session-storage-in-cassandra-datastax-enterprise">Session Storage in Cassandra / DataStax Enterprise</a>
              </li>
            
            </ul>
          </li>
          
        </ul>
      </nav>
    </div>
  </div>
</section>


  
  <footer class="footer">
    <div class="container level">
      <div class="level-left">
        <div class="level-item">
          <p>
            <strong>KillrVideo</strong> is open source and available under an 
            <a href="http://www.apache.org/licenses/LICENSE-2.0" target="_blank">Apache 2.0</a> license.
          <p>
          <p>
            <small>Site version <a href="https://github.com/KillrVideo/killrvideo.github.io/commit/770ece5b2b38d354e77857dc7e09c08ff729e625" target="_blank">770ece5</a></small>
          </p>
        </div>
      </div>
      <div class="level-right">
        <div class="level-right">
          <a class="button level-item" href="https://github.com/KillrVideo/killrvideo.github.io/tree/source/src/site/docs/guides/docker.md" target="_blank">
            <i class="fa fa-github fa-fw"></i>Improve this page
          </a>
        </div>
      </div>
    </div>
  </footer>
  
  <script type="text/javascript" src="/assets/js/bundle.js"></script>
</body>
</html>